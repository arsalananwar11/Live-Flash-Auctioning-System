{% extends "shared/main.html" %}

{% block page_body %}
<script src="{{ url_for('static', filename='js/auction_details.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/auction_details.css') }}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>

<main class="auction-page">
    <div class="product-info">
        <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/07d3df17349a7fe24612154aa00166bf01c75b0ee1a06662800483bf06c85980?placeholderIfAbsent=true&apiKey=ef34feccb14a4349a0b21d81082028c5" alt="Product icon" class="product-icon" />
        <h2 class="auction-item">{{ auction.auction_item }}</h2>
    </div>
    <img src="https://cdn.builder.io/api/v1/image/assets/TEMP/21281a090b1e1de893f32056f0a670815b206286aac025adc90c8d604fd08d4c?placeholderIfAbsent=true&apiKey=ef34feccb14a4349a0b21d81082028c5" alt="Product image" class="product-image" />
    
    <div class="product-details">
        <p class="auction-desc">
            {{ auction.auction_desc }}
        </p>
        <div class="time-remaining">Time Remaining</div>
        <div class="top-bid">TopBid</div>
        <div class="time-frame">00:32:10</div>
        <div class="bid-frame">
            <span>$</span>
            <span>1200</span>
        </div>
        <h2>Remaining Time: <span id="remaining-time">Calculating...</span></h2>
    </div>

    <div class="leaderboard-container">
        <h3 class="leaderboard-title">Leaderboard</h3>
        <table class="leaderboard-table">
            <thead>
                <tr class="table-header">
                    <th class="table-cell"><div class="cell-content">Rank</div></th>
                    <th class="table-cell"><div class="cell-content">Username</div></th>
                    <th class="table-cell"><div class="cell-content">Bid</div></th>
                    <th class="table-cell"><div class="cell-content">Time</div></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    
    <div class="bid-buttons">
    </div>
</main>
<script>
    const socket = io.connect('http://localhost:5000');

    // Listen for the auction time update
    socket.on('auction_time_update', (data) => {
        const remainingTime = data.remaining_time;
        // Convert the time (in seconds) to minutes and seconds
        const minutes = Math.floor(remainingTime / 60);
        const seconds = Math.floor(remainingTime % 60);
        document.getElementById('remaining-time').textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
    });

    // Emit join_auction event when the user joins the auction
    function joinAuction(auctionId, userId) {
        socket.emit('join_auction', {
            auction_id: auctionId,
            user_id: userId
        });
    }

    // Listen for auction end notification
    socket.on('auction_ended', (data) => {
        alert(data.message);
        document.getElementById('remaining-time').textContent = "Auction Ended";
    });

    // Clean up when the user leaves
    window.addEventListener('beforeunload', () => {
        socket.emit('leave_auction', { auction_id: "{{ auction.auction_id }}" });
    });
</script>
{% endblock %}

